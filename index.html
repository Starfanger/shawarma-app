<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Doner Duck</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç Telegram -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; margin: 0; padding: 20px; background: #fff; color: #333; }
        .hidden { display: none; }
        .error-box { background: #ffdddd; border: 2px solid #ff0000; padding: 20px; border-radius: 10px; text-align: center; }
        .btn { background: #ff5e00; color: white; border: none; padding: 15px; width: 100%; border-radius: 10px; font-size: 18px; font-weight: bold; margin-top: 20px; cursor: pointer; }
        .btn:disabled { background: #ccc; }
        input, select { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        .log-area { background: #f0f0f0; padding: 10px; font-size: 12px; margin-top: 20px; border-radius: 5px; max-height: 150px; overflow-y: auto; }
        h2 { color: #ff5e00; }
        .option-group { display: flex; gap: 10px; margin-bottom: 15px; }
        .option { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px; text-align: center; cursor: pointer; }
        .option.active { border-color: #ff5e00; background: #fff8f0; font-weight: bold; }
    </style>
</head>
<body>

    <!-- –ë–ª–æ–∫ –æ—à–∏–±–∫–∏, –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ –Ω–µ –≤ Telegram -->
    <div id="errorBlock" class="error-box hidden">
        <h3>‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞!</h3>
        <p>–í—ã –æ—Ç–∫—Ä—ã–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –æ–±—ã—á–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ.</p>
        <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–∫—Ä–æ–π—Ç–µ –µ–≥–æ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –≤ –±–æ—Ç–µ Telegram.</p>
        <p id="debugInfo" style="font-size: 12px; color: #555;"></p>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div id="appContent" class="hidden">
        <h2>üåØ Doner Duck</h2>
        
        <label>–¢–∏–ø —à–∞—É—Ä–º—ã:</label>
        <div class="option-group">
            <div class="option active" onclick="selectType('chicken', this)">–ö—É—Ä–∏–Ω–∞—è</div>
            <div class="option" onclick="selectType('beef', this)">–ú—è—Å–Ω–∞—è</div>
        </div>

        <label>–†–∞–∑–º–µ—Ä:</label>
        <div class="option-group">
            <div class="option active" onclick="selectSize('standard', this)">–°—Ç–∞–Ω–¥–∞—Ä—Ç (5.00 Br)</div>
            <div class="option" onclick="selectSize('large', this)">–ë–æ–ª—å—à–∞—è (7.50 Br)</div>
        </div>

        <label>–î–æ–±–∞–≤–∫–∏:</label>
        <div style="margin-bottom: 15px;">
            <label><input type="checkbox" id="ing_meat" value="extra_meat" data-price="1.50"> –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –º—è—Å–æ (+1.50)</label><br>
            <label><input type="checkbox" id="ing_sauce" value="spicy_sauce" data-price="0.30"> –û—Å—Ç—Ä—ã–π —Å–æ—É—Å (+0.30)</label>
        </div>

        <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
        <input type="number" id="qty" value="1" min="1" onchange="calcTotal()">

        <h3>–ò—Ç–æ–≥–æ: <span id="totalDisplay">5.00</span> Br</h3>

        <button class="btn" id="orderBtn" onclick="sendOrder()">–û–§–û–†–ú–ò–¢–¨ –ó–ê–ö–ê–ó</button>

        <div class="log-area" id="consoleLog">–õ–æ–≥ —Å–æ–±—ã—Ç–∏–π...</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        let currentType = 'chicken';
        let currentSize = 'standard';
        
        // –¶–µ–Ω—ã
        const prices = {
            chicken: { standard: 5.00, large: 7.50 },
            beef: { standard: 6.00, large: 8.50 }
        };

        function log(msg) {
            const el = document.getElementById('consoleLog');
            el.innerHTML += `<div>> ${msg}</div>`;
            el.scrollTop = el.scrollHeight;
            console.log(msg);
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—Å–∫–∞
        if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
            log("Telegram –æ–±–Ω–∞—Ä—É–∂–µ–Ω!");
            log("User: " + tg.initDataUnsafe.user.first_name);
            
            document.getElementById('errorBlock').classList.add('hidden');
            document.getElementById('appContent').classList.remove('hidden');
            
            tg.expand(); // –†–∞—Å–∫—Ä—ã—Ç—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
            tg.ready();  // –°–æ–æ–±—â–∏—Ç—å —Ç–µ–ª–µ–≥—Ä–∞–º—É –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
        } else {
            log("Telegram –ù–ï –æ–±–Ω–∞—Ä—É–∂–µ–Ω!");
            document.getElementById('errorBlock').classList.remove('hidden');
            document.getElementById('debugInfo').innerText = "tg.initData: " + (tg.initData ? "–ï—Å—Ç—å" : "–ù–µ—Ç");
        }

        function selectType(type, el) {
            currentType = type;
            document.querySelectorAll('.option-group:first-child .option').forEach(e => e.classList.remove('active'));
            el.classList.add('active');
            calcTotal();
            log("–í—ã–±—Ä–∞–Ω —Ç–∏–ø: " + type);
        }

        function selectSize(size, el) {
            currentSize = size;
            document.querySelectorAll('.option-group:last-child .option').forEach(e => e.classList.remove('active'));
            el.classList.add('active');
            calcTotal();
            log("–í—ã–±—Ä–∞–Ω —Ä–∞–∑–º–µ—Ä: " + size);
        }

        function calcTotal() {
            let base = prices[currentType][currentSize];
            let extras = 0;
            
            if(document.getElementById('ing_meat').checked) extras += 1.50;
            if(document.getElementById('ing_sauce').checked) extras += 0.30;
            
            let qty = parseInt(document.getElementById('qty').value) || 1;
            let total = (base + extras) * qty;
            
            document.getElementById('totalDisplay').innerText = total.toFixed(2);
            return total;
        }

       function sendOrder() {
    const btn = document.getElementById('orderBtn');
    
    // 1. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
    alert("–ù–ê–ß–ê–õ–û –û–¢–ü–†–ê–í–ö–ò! –î–∞–Ω–Ω—ã–µ –≥–æ—Ç–æ–≤—ã.");
    
    btn.disabled = true;
    btn.innerText = "–û—Ç–ø—Ä–∞–≤–∫–∞...";
    
    log("–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...");
    
    const orderData = {
        type: currentType,
        size: currentSize,
        quantity: parseInt(document.getElementById('qty').value),
        ingredients: [],
        total: calcTotal(),
        currency: "BYN",
        test_id: Math.random() // –î–æ–±–∞–≤–∏–º —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å
    };

    if(document.getElementById('ing_meat').checked) orderData.ingredients.push("–ú—è—Å–æ");
    if(document.getElementById('ing_sauce').checked) orderData.ingredients.push("–°–æ—É—Å");

    log("–î–∞–Ω–Ω—ã–µ: " + JSON.stringify(orderData));

    try {
        // 2. –ü—Ä–æ–±—É–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å
        tg.sendData(JSON.stringify(orderData));
        log("‚úÖ sendData –≤—ã–∑–≤–∞–Ω!");
        
        // 3. –í—Ç–æ—Ä–æ–µ –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ
        setTimeout(() => {
            alert("–û–¢–ü–†–ê–í–õ–ï–ù–û –í TELEGRAM! –¢–µ–ø–µ—Ä—å –∂–¥–µ–º –æ—Ç–≤–µ—Ç–∞ –±–æ—Ç–∞...");
            tg.close();
        }, 500);
        
    } catch (e) {
        log("‚ùå –û—à–∏–±–∫–∞: " + e.message);
        alert("–û–®–ò–ë–ö–ê –û–¢–ü–†–ê–í–ö–ò: " + e.message);
        btn.disabled = false;
    }
}

            if(document.getElementById('ing_meat').checked) orderData.ingredients.push("–ú—è—Å–æ");
            if(document.getElementById('ing_sauce').checked) orderData.ingredients.push("–°–æ—É—Å");

            log("–î–∞–Ω–Ω—ã–µ: " + JSON.stringify(orderData));

            // –ì–õ–ê–í–ù–û–ï: –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É
            try {
                tg.sendData(JSON.stringify(orderData));
                log("‚úÖ sendData –≤—ã–∑–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ!");
                btn.innerText = "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! –ó–∞–∫—Ä—ã–≤–∞—é...";
                
                setTimeout(() => {
                    tg.close();
                }, 1500);
            } catch (e) {
                log("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: " + e.message);
                btn.disabled = false;
                btn.innerText = "–û—à–∏–±–∫–∞! –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞";
                alert("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: " + e.message);
            }
        }
    </script>
</body>
</html>
