<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–®–∞—É—Ä–º–∞ v3.0</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #0f172a;
            --card: rgba(30, 41, 59, 0.7);
            --primary: #00ff88;
            --text: #f8fafc;
            --accent: #ff0055;
            --glass: rgba(255, 255, 255, 0.1);
        }

        body.light {
            --bg: #f1f5f9;
            --card: rgba(255, 255, 255, 0.8);
            --text: #0f172a;
            --glass: rgba(0, 0, 0, 0.05);
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0; padding: 0; transition: 0.3s;
            overflow-x: hidden;
        }

        header {
            padding: 20px; display: flex; justify-content: space-between; align-items: center;
            backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 100;
        }

        .theme-toggle { font-size: 24px; cursor: pointer; }

        .container { padding: 0 16px 120px; }

        /* –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ */
        .tabs { display: flex; gap: 10px; overflow-x: auto; padding: 10px 0; scrollbar-width: none; }
        .tab {
            padding: 10px 20px; background: var(--glass); border-radius: 20px;
            white-space: nowrap; font-size: 14px; border: 1px solid transparent;
        }
        .tab.active { border-color: var(--primary); background: rgba(0, 255, 136, 0.1); color: var(--primary); font-weight: bold; }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .item-card {
            background: var(--card); backdrop-filter: blur(15px); border-radius: 24px;
            padding: 20px; margin-bottom: 16px; border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); transition: 0.3s;
        }
        .item-card:active { transform: scale(0.97); }
        .item-card h3 { margin: 0 0 8px; font-size: 20px; display: flex; align-items: center; gap: 8px; }
        .item-card p { font-size: 13px; opacity: 0.7; margin: 0; }
        .price-row { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; }
        .price { font-size: 18px; font-weight: 900; color: var(--primary); }

        /* –ú–æ–¥–∞–ª–∫–∞ */
        #modalOverlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px);
            display: none; justify-content: center; align-items: flex-end; z-index: 1000;
        }
        .modal {
            background: var(--bg); width: 100%; max-height: 85vh; border-radius: 30px 30px 0 0;
            padding: 30px 20px; overflow-y: auto; position: relative;
        }
        .modal-close { position: absolute; top: 20px; right: 20px; font-size: 24px; opacity: 0.5; }

        .extra-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 20px 0; }
        .extra-btn {
            background: var(--glass); padding: 12px; border-radius: 15px; text-align: center;
            font-size: 12px; border: 1px solid transparent; transition: 0.2s;
        }
        .extra-btn.active { border-color: var(--primary); background: rgba(0, 255, 136, 0.1); }

        .qty-control { display: flex; align-items: center; justify-content: center; gap: 25px; margin: 25px 0; }
        .qty-btn { width: 45px; height: 45px; border-radius: 50%; border: 2px solid var(--primary); background: none; color: var(--primary); font-size: 24px; }

        /* –ö–æ—Ä–∑–∏–Ω–∞ */
        .footer-cart {
            position: fixed; bottom: 20px; left: 16px; right: 16px;
            background: linear-gradient(135deg, var(--primary), #00bdff);
            border-radius: 20px; padding: 20px; color: #000; display: none;
            justify-content: space-between; align-items: center; font-weight: 900;
            box-shadow: 0 10px 40px rgba(0, 255, 136, 0.4); z-index: 500;
        }
    </style>
</head>
<body>

<header>
    <h1>üåØ –®–ê–£–†–ú–ê v3.0</h1>
    <div class="theme-toggle" id="themeBtn">üåì</div>
</header>

<div class="container">
    <div class="tabs">
        <div class="tab active" onclick="filter('all')">–í—Å—ë –º–µ–Ω—é üî•</div>
        <div class="tab" onclick="filter('elderly')">üëµ –ü–æ–∂–∏–ª—ã–º</div>
        <div class="tab" onclick="filter('disco')">üï∫ –¢–∞–Ω—Ü—ã</div>
        <div class="tab" onclick="filter('legend')">üèÜ –õ–µ–≥–µ–Ω–¥—ã</div>
    </div>
    <div id="catalog"></div>
</div>

<div id="modalOverlay">
    <div class="modal">
        <div class="modal-close" onclick="closeModal()">‚úï</div>
        <h2 id="mName">–ù–∞–∑–≤–∞–Ω–∏–µ</h2>
        <p id="mDesc" style="opacity: 0.6; font-size: 14px;">–û–ø–∏—Å–∞–Ω–∏–µ</p>
        
        <div class="section-label" style="margin-top:20px; font-weight: bold;">–î–û–ë–ê–í–ò–¢–¨ –†–û–§–õ–û–í:</div>
        <div class="extra-grid" id="mExtras"></div>

        <div class="qty-control">
            <button class="qty-btn" onclick="changeQty(-1)">-</button>
            <span id="mQty" style="font-size: 24px; font-weight: 900;">1</span>
            <button class="qty-btn" onclick="changeQty(1)">+</button>
        </div>

        <button onclick="confirmItem()" style="width: 100%; padding: 18px; border-radius: 15px; border: none; background: var(--primary); color: #000; font-weight: 900; font-size: 16px;">
            –î–û–ë–ê–í–ò–¢–¨ –í –ö–û–†–ó–ò–ù–£ ‚Äî <span id="mTotal">0</span> BYN
        </button>
    </div>
</div>

<div class="footer-cart" id="cartBar" onclick="sendOrder()">
    <span>üõí –í –ö–û–†–ó–ò–ù–ï: <span id="cCount">0</span></span>
    <span>–û–§–û–†–ú–ò–¢–¨: <span id="cPrice">0</span> BYN</span>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    const menu = [
        { id: 1, cat: 'elderly', icon: 'üë¥', name: '–î–∞-–¥–∞-—è', price: 7.0, desc: '–ü–æ–∂–∏–ª–æ–π –∫—Ä–æ–ª–∏–∫ –æ–¥–æ–±—Ä—è–µ—Ç. –í–∫—É—Å 54-—Ö –ª–µ—Ç.' },
        { id: 2, cat: 'elderly', icon: 'üß™', name: '–ñ–º—ã—à–µ–Ω–∫–æ –í–∞–ª–µ—Ä–∏–π', price: 9.5, desc: '–î–≤–æ–π–Ω–∞—è –ø–æ—Ä—Ü–∏—è —Ä–æ—Ñ–ª–∞. –û—Å—Ç–æ—Ä–æ–∂–Ω–æ, –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–∏–≤—ã–∫–∞–Ω–∏–µ.' },
        { id: 3, cat: 'disco', icon: 'üíÉ', name: '–ó–≤–µ–∑–¥–∞ –î–∏—Å–∫–æ—Ç–µ–∫', price: 11.0, desc: '–ò–≥–æ—Ä—å –í–∏—Ö–æ—Ä—å–∫–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç. –ß–µ—Å–Ω–æ—á–Ω—ã–π —Å–æ—É—Å –¥–ª—è –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏.' },
        { id: 4, cat: 'disco', icon: 'üí®', name: '–Ø –ø—É–∫–∞—é', price: 8.0, desc: '–í–∑—Ä—ã–≤–Ω–∞—è —Å–º–µ—Å—å —Ñ–∞—Å–æ–ª–∏ –∏ –ø–µ—Ä—Ü–∞. –¢–æ–ª—å–∫–æ –¥–ª—è —Å–º–µ–ª—ã—Ö.' },
        { id: 5, cat: 'legend', icon: 'üåå', name: '–ò–¥—É—â–∏–π –∫ —Ä–µ–∫–µ', price: 15.0, desc: '–ë–µ—Å–∫–æ–Ω–µ—á–Ω–æ –¥–ª–∏–Ω–Ω—ã–π —Ä–æ–ª–ª. –î–ª—è —Ç–µ—Ö, –∫—Ç–æ –≤—Å—ë –ø–æ–∑–Ω–∞–ª.' },
        { id: 6, cat: 'legend', icon: 'üëî', name: '–ê–î–í–û–ö–ê–¢!', price: 9.0, desc: '–í—ã–∏–≥—Ä–∞–µ—Ç –ª—é–±–æ–µ –¥–µ–ª–æ –≤ —Ç–≤–æ–µ–º –∂–µ–ª—É–¥–∫–µ.' }
    ];

    const extras = [
        { name: 'üßÄ –°—ã—Ä–Ω—ã–π –≤–∑—Ä—ã–≤', price: 1.5 },
        { name: 'üå∂ –°–ª—ë–∑—ã –≤—Ä–∞–≥–æ–≤', price: 0.8 },
        { name: 'ü•ì –ú—è—Å–æ X2', price: 3.0 },
        { name: 'ü•î –ß–∏–ø—Å—ã –≤–Ω—É—Ç—Ä–∏', price: 1.2 }
    ];

    let cart = [];
    let currentItem = null;
    let selectedExtras = new Set();
    let currentQty = 1;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    function init() {
        if (tg.colorScheme === 'light') document.body.classList.add('light');
        render('all');
    }

    function render(cat) {
        const catalog = document.getElementById('catalog');
        catalog.innerHTML = '';
        menu.forEach(item => {
            if (cat !== 'all' && item.cat !== cat) return;
            const div = document.createElement('div');
            div.className = 'item-card';
            div.innerHTML = `
                <h3>${item.icon} ${item.name}</h3>
                <p>${item.desc}</p>
                <div class="price-row">
                    <span class="price">${item.price.toFixed(2)} BYN</span>
                    <button class="add-btn" style="background:var(--primary); border:none; border-radius:10px; padding:8px 15px; font-weight:bold" onclick="openModal(${item.id})">–í–´–ë–†–ê–¢–¨</button>
                </div>
            `;
            catalog.appendChild(div);
        });
    }

    function openModal(id) {
        currentItem = menu.find(m => m.id === id);
        selectedExtras.clear();
        currentQty = 1;
        
        document.getElementById('mName').innerText = currentItem.icon + ' ' + currentItem.name;
        document.getElementById('mDesc').innerText = currentItem.desc;
        document.getElementById('mQty').innerText = currentQty;
        
        const extraGrid = document.getElementById('mExtras');
        extraGrid.innerHTML = '';
        extras.forEach(ex => {
            const btn = document.createElement('div');
            btn.className = 'extra-btn';
            btn.innerText = `${ex.name} (+${ex.price})`;
            btn.onclick = () => toggleExtra(btn, ex);
            extraGrid.appendChild(btn);
        });

        updateModalPrice();
        document.getElementById('modalOverlay').style.display = 'flex';
    }

    function toggleExtra(el, ex) {
        if (selectedExtras.has(ex)) {
            selectedExtras.delete(ex);
            el.classList.remove('active');
        } else {
            selectedExtras.add(ex);
            el.classList.add('active');
        }
        updateModalPrice();
    }

    function changeQty(v) {
        currentQty = Math.max(1, Math.min(10, currentQty + v));
        document.getElementById('mQty').innerText = currentQty;
        updateModalPrice();
    }

    function updateModalPrice() {
        let price = currentItem.price;
        selectedExtras.forEach(ex => price += ex.price);
        document.getElementById('mTotal').innerText = (price * currentQty).toFixed(2);
    }

    function closeModal() { document.getElementById('modalOverlay').style.display = 'none'; }

    function confirmItem() {
        let price = currentItem.price;
        selectedExtras.forEach(ex => price += ex.price);
        
        cart.push({
            name: currentItem.name,
            qty: currentQty,
            price: price * currentQty,
            extras: Array.from(selectedExtras).map(e => e.name)
        });

        closeModal();
        updateCartBar();
        if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
    }

    function updateCartBar() {
        const bar = document.getElementById('cartBar');
        if (cart.length > 0) {
            bar.style.display = 'flex';
            const total = cart.reduce((s, i) => s + i.price, 0);
            document.getElementById('cPrice').innerText = total.toFixed(2);
            document.getElementById('cCount').innerText = cart.length;
        }
    }

    function filter(c) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        event.target.classList.add('active');
        render(c);
    }

    function sendOrder() {
        const total = cart.reduce((s, i) => s + i.price, 0);
        const data = {
            items: cart,
            total: total,
            user: tg.initDataUnsafe.user?.first_name || "–ß–µ–ø—É—Ö"
        };
        tg.sendData(JSON.stringify(data));
    }

    document.getElementById('themeBtn').onclick = () => document.body.classList.toggle('light');

    init();
</script>
</body>
</html>
